<div class="card">
  <p-toast></p-toast>
  <p-toolbar styleClass="mb-4 gap-2">
    <ng-template pTemplate="left">
      @if (userRole == '2') {
        <p-button
          label="New"
          icon="pi pi-plus"
          class="p-button-success p-mr-2"
          (onClick)="openNew()"
        />
      }
    </ng-template>
    <ng-template pTemplate="right">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input
          type="text"
          pInputText
          placeholder="Search..."
          #globalFilterInput
          (input)="dt.filterGlobal(globalFilterInput.value, 'contains')" />
      </span>
    </ng-template>
  </p-toolbar>

  <p-table
    #dt
    [value]="locations"
    [paginator]="true"
    [rows]="10"
    [globalFilterFields]="['name', 'address', 'capacity']"
    [tableStyle]="{ 'min-width': '75rem' }"
    dataKey="id"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    [showCurrentPageReport]="true"
    [rowHover]="true">

    <ng-template pTemplate="caption">
      <div class="flex align-items-center justify-content-between">
        <h5 class="m-0">Manage Locations</h5>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="name" style="min-width:15rem">
          Name <p-sortIcon field="name"></p-sortIcon>
        </th>
        <th pSortableColumn="address">
          Address <p-sortIcon field="address"></p-sortIcon>
        </th>
        <th pSortableColumn="capacity">
          Capacity <p-sortIcon field="capacity"></p-sortIcon>
        </th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-location>
      <tr>
        <td>{{ location.name }}</td>
        <td>{{ location.address }}</td>
        <td>{{ location.capacity }}</td>
        <td>
          @if (userRole == '2') {
            <div class="flex align-items-center justify-content-center gap-2">
              <p-button
                icon="pi pi-pencil"
                class="p-button-rounded p-button-warning"
                (onClick)="editLocation(location)"
                tooltip="Edit"
                tooltipPosition="top" />
              <p-button
                icon="pi pi-trash"
                class="p-button-rounded p-button-danger"
                (onClick)="confirmDelete(location)"
                tooltip="Delete"
                tooltipPosition="top" />
            </div>
          }
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="summary">
      <div class="flex align-items-center justify-content-between">
        In total there are {{ locations ? locations.length : 0 }} locations.
      </div>
    </ng-template>
  </p-table>

  <!-- Діалог для створення/редагування локації -->
  <p-dialog
    header="{{ isEdit ? 'Edit Location' : 'New Location' }}"
    [(visible)]="locationDialog"
    [modal]="true"
    [style]="{ width: '450px' }"
    [closable]="false"
    [dismissableMask]="true"
    [resizable]="false"
    [draggable]="false"
    class="p-fluid">

    <form (ngSubmit)="saveLocation()">
      <div class="field">
        <label for="name">Name</label>
        <input
          id="name"
          type="text"
          pInputText
          [(ngModel)]="location.name"
          name="name"
          required
          autofocus />
        <small class="p-error" *ngIf="submitted && !location.name">
          Name is required.
        </small>
      </div>
      <div class="field">
        <label for="address">Address</label>
        <input
          id="address"
          type="text"
          pInputText
          [(ngModel)]="location.address"
          name="address"
          required />
        <small class="p-error" *ngIf="submitted && !location.address">
          Address is required.
        </small>
      </div>
      <div class="field">
        <label for="capacity">Capacity</label>
        <input
          id="capacity"
          type="number"
          pInputText
          [(ngModel)]="location.capacity"
          name="capacity"
          required
          min="1" />
        <small class="p-error" *ngIf="submitted && (!location.capacity || location.capacity <= 0)">
          Capacity must be a positive number.
        </small>
      </div>

      <div class="p-dialog-footer">
        <p-button
          label="Cancel"
          icon="pi pi-times"
          class="p-button-text"
          (onClick)="hideDialog()" />
        <p-button
          label="Save"
          icon="pi pi-check"
          type="submit"
          [disabled]="!location.name || !location.address || !location.capacity" />
      </div>
    </form>
  </p-dialog>

  <!-- Підтвердження видалення -->
  <p-confirmDialog
    header="Confirm Delete"
    icon="pi pi-exclamation-triangle"
    [style]="{ width: '450px' }">
  </p-confirmDialog>
</div>
